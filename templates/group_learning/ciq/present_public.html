{% extends 'base.html' %}
{% load static %}

{% block title %}{{ team.team_name }} - Team Presentation - CIQ{% endblock %}

{% block extra_head %}
<style>
    /* Chalkboard-style header */
    .chalkboard-header {
        background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
        background-image:
            linear-gradient(135deg, #2d3748 0%, #1a202c 100%),
            url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
    }

    .notebook-card {
        background: linear-gradient(180deg, #ffffff 0%, #fefefe 100%);
        position: relative;
    }

    .notebook-card::before {
        content: '';
        position: absolute;
        left: 20px;
        top: 0;
        bottom: 0;
        width: 2px;
        background: #e5e7eb;
    }

    /* Phase icon decorations */
    .phase-icon {
        font-size: 3rem;
        opacity: 0.15;
        position: absolute;
        top: 10px;
        right: 10px;
    }
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-blue-50 via-white to-green-50">

    {% if error %}
        {% include 'group_learning/ciq/partials/alert.html' with type='error' message=error icon='‚ùå' %}
    {% else %}

    <!-- Chalkboard Header -->
    <div class="chalkboard-header text-white py-12 px-4 shadow-xl">
        <div class="max-w-5xl mx-auto">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-4xl font-bold mb-2 flex items-center gap-3">
                        <span class="text-5xl">{{ team.team_emoji }}</span>
                        {{ team.team_name }}
                    </h1>
                    <p class="text-lg text-gray-300">Creative Inquiry Quest Journey</p>
                    <p class="text-sm text-gray-400 mt-1">{{ session.session_code }} ‚Ä¢ {{ team.member_count }} member{{ team.member_count|pluralize }}</p>
                </div>
                <div class="text-right">
                    <button onclick="copyLink()" class="bg-white text-gray-800 px-6 py-3 rounded-lg font-semibold hover:bg-gray-100 transition-all shadow-md flex items-center gap-2">
                        <span>üîó</span>
                        Copy Link
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-5xl mx-auto py-8 px-4">

        <!-- Journey Phases -->
        {% for mission in missions %}
        {% with phase_type=mission.mission_type %}
        <div class="notebook-card rounded-xl shadow-lg border border-gray-200 p-8 mb-6 relative overflow-hidden">

            <!-- Phase Icon Decoration -->
            <div class="phase-icon">
                {% if phase_type == 'empathy' %}üë•{% endif %}
                {% if phase_type == 'define' %}üéØ{% endif %}
                {% if phase_type == 'ideate' %}üí°{% endif %}
                {% if phase_type == 'prototype' %}üõ†Ô∏è{% endif %}
                {% if phase_type == 'showcase' %}üéì{% endif %}
            </div>

            <!-- Phase Header -->
            <div class="mb-6 relative z-10">
                <h2 class="text-3xl font-bold text-gray-900 mb-2 flex items-center gap-3">
                    <span class="text-4xl">
                        {% if phase_type == 'empathy' %}üë•{% endif %}
                        {% if phase_type == 'define' %}üéØ{% endif %}
                        {% if phase_type == 'ideate' %}üí°{% endif %}
                        {% if phase_type == 'prototype' %}üõ†Ô∏è{% endif %}
                        {% if phase_type == 'showcase' %}üéì{% endif %}
                    </span>
                    {{ mission.title }}
                </h2>
                <p class="text-gray-600 pl-16">{{ mission.description }}</p>
            </div>

            <!-- Phase Responses -->
            {% with responses=phase_responses|get_item:phase_type %}
            {% if responses %}
            <div class="space-y-4 pl-8">
                {% for response in responses %}
                <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            {% if response.input_data.question %}
                                <p class="font-semibold text-gray-800 mb-2">{{ response.input_data.question }}</p>
                            {% endif %}

                            {% if response.input_data.response %}
                                <p class="text-gray-700">{{ response.input_data.response }}</p>
                            {% elif response.response_text %}
                                <p class="text-gray-700">{{ response.response_text }}</p>
                            {% endif %}

                            {% if response.input_data.items %}
                                <ul class="list-disc list-inside space-y-1 text-gray-700">
                                    {% for item in response.input_data.items %}
                                        <li>{{ item }}</li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                        </div>

                        {% if response.teacher_score %}
                        <div class="ml-4">
                            <div class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-semibold">
                                Score: {{ response.teacher_score }}/10
                            </div>
                        </div>
                        {% endif %}
                    </div>

                    <div class="mt-2 text-xs text-gray-500">
                        Submitted {{ response.submitted_at|date:"M d, Y ‚Ä¢ g:i A" }}
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="pl-8 text-gray-500 italic">
                No responses submitted yet for this phase.
            </div>
            {% endif %}
            {% endwith %}
        </div>
        {% endwith %}
        {% endfor %}

        <!-- Footer -->
        <div class="text-center mt-12 text-gray-600">
            <p class="text-sm">
                Powered by <span class="font-semibold">Creative Inquiry Quest</span> ‚Ä¢ DecipherWorld
            </p>
        </div>

    </div>

    {% endif %}
</div>

{% include 'group_learning/ciq/partials/toast.html' %}

<script>
function copyLink() {
    const url = '{{ public_url }}';
    navigator.clipboard.writeText(url).then(() => {
        showToast('Link copied to clipboard!', 'success');
    }).catch(err => {
        showToast('Failed to copy link', 'error');
    });
}

// Custom template filter polyfill for get_item
if (!String.prototype.get_item) {
    // This is handled by Django template, no need for JS polyfill
}
</script>
{% endblock %}
