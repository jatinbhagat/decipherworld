<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Group Learning{% endblock %} - DecipherWorld</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="{% block description %}Collaborative group learning through immersive role-playing scenarios. Learn climate change, problem-solving, and teamwork through engaging educational games.{% endblock %}">
    <meta name="keywords" content="{% block keywords %}group learning, collaborative education, role-playing games, climate education, scenario-based learning, educational games, teamwork, problem solving{% endblock %}">
    <meta name="author" content="DecipherWorld">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="{{ request.build_absolute_uri }}">
    
    <!-- Favicon -->
    <link rel="icon" href="data:text/plain;base64,8J+PvzwvdGV4dD4=" type="image/x-icon">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="{% block og_title %}{{ block.super }}{% endblock %}">
    <meta property="og:description" content="{% block og_description %}Experience collaborative learning through immersive role-playing scenarios and educational games.{% endblock %}">
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ request.build_absolute_uri }}">
    <meta property="og:site_name" content="DecipherWorld - Group Learning">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@DecipherWorld">
    <meta name="twitter:title" content="{% block twitter_title %}{{ block.super }}{% endblock %}">
    <meta name="twitter:description" content="{% block twitter_description %}Collaborative group learning through educational scenarios and games.{% endblock %}">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Enhanced Design System -->
    <style>
        /* Design System Foundation */
        :root {
            /* Spacing Scale */
            --space-1: 0.25rem;   /* 4px */
            --space-2: 0.5rem;    /* 8px */
            --space-3: 0.75rem;   /* 12px */
            --space-4: 1rem;      /* 16px */
            --space-5: 1.25rem;   /* 20px */
            --space-6: 1.5rem;    /* 24px */
            --space-8: 2rem;      /* 32px */
            --space-10: 2.5rem;   /* 40px */
            --space-12: 3rem;     /* 48px */
            --space-16: 4rem;     /* 64px */
            --space-20: 5rem;     /* 80px */
            
            /* Typography Scale */
            --text-xs: 0.75rem;     /* 12px */
            --text-sm: 0.875rem;    /* 14px */
            --text-base: 1rem;      /* 16px */
            --text-lg: 1.125rem;    /* 18px */
            --text-xl: 1.25rem;     /* 20px */
            --text-2xl: 1.5rem;     /* 24px */
            --text-3xl: 1.875rem;   /* 30px */
            --text-4xl: 2.25rem;    /* 36px */
            
            /* Line Heights */
            --leading-tight: 1.25;
            --leading-normal: 1.5;
            --leading-relaxed: 1.625;
            
            /* Border Radius Scale */
            --radius-sm: 0.375rem;   /* 6px */
            --radius-md: 0.5rem;     /* 8px */
            --radius-lg: 0.75rem;    /* 12px */
            --radius-xl: 1rem;       /* 16px */
            --radius-2xl: 1.5rem;    /* 24px */
            
            /* Color Palette */
            --primary-50: #eff6ff;
            --primary-100: #dbeafe;
            --primary-500: #3b82f6;
            --primary-600: #2563eb;
            --primary-700: #1d4ed8;
            
            --success-50: #ecfdf5;
            --success-100: #d1fae5;
            --success-500: #10b981;
            --success-600: #059669;
            
            --warning-50: #fffbeb;
            --warning-100: #fef3c7;
            --warning-500: #f59e0b;
            --warning-600: #d97706;
            
            --error-50: #fef2f2;
            --error-100: #fee2e2;
            --error-500: #ef4444;
            --error-600: #dc2626;
            
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            
            /* Animation Timing */
            --duration-fast: 150ms;
            --duration-normal: 300ms;
            --duration-slow: 500ms;
            --ease-in-out: cubic-bezier(0.4, 0, 0.2, 1);
            --ease-out: cubic-bezier(0, 0, 0.2, 1);
        }
        
        /* Typography System */
        .text-display-1 {
            font-size: var(--text-4xl);
            font-weight: 800;
            line-height: var(--leading-tight);
            letter-spacing: -0.025em;
        }
        
        .text-display-2 {
            font-size: var(--text-3xl);
            font-weight: 700;
            line-height: var(--leading-tight);
            letter-spacing: -0.025em;
        }
        
        .text-heading-1 {
            font-size: var(--text-2xl);
            font-weight: 600;
            line-height: var(--leading-tight);
        }
        
        .text-heading-2 {
            font-size: var(--text-xl);
            font-weight: 600;
            line-height: var(--leading-normal);
        }
        
        .text-heading-3 {
            font-size: var(--text-lg);
            font-weight: 600;
            line-height: var(--leading-normal);
        }
        
        .text-body-lg {
            font-size: var(--text-lg);
            line-height: var(--leading-relaxed);
        }
        
        .text-body {
            font-size: var(--text-base);
            line-height: var(--leading-normal);
        }
        
        .text-body-sm {
            font-size: var(--text-sm);
            line-height: var(--leading-normal);
        }
        
        .text-caption {
            font-size: var(--text-xs);
            line-height: var(--leading-normal);
            font-weight: 500;
        }
        
        /* Component Base Classes */
        .card {
            background: white;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--gray-100);
            transition: all var(--duration-normal) var(--ease-out);
        }
        
        .card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-1px);
        }
        
        .card-interactive {
            cursor: pointer;
            transition: all var(--duration-fast) var(--ease-out);
        }
        
        .card-interactive:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl);
            border-color: var(--primary-200);
        }
        
        .card-interactive:focus-within {
            outline: 2px solid var(--primary-500);
            outline-offset: 2px;
        }
        
        /* Button System */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-3) var(--space-5);
            border-radius: var(--radius-lg);
            font-weight: 600;
            font-size: var(--text-sm);
            line-height: var(--leading-normal);
            transition: all var(--duration-fast) var(--ease-out);
            border: none;
            cursor: pointer;
            min-height: 44px;
            position: relative;
            overflow: hidden;
        }
        
        .btn:focus {
            outline: 2px solid var(--primary-500);
            outline-offset: 2px;
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-500), var(--primary-600));
            color: white;
            box-shadow: var(--shadow-sm);
        }
        
        .btn-primary:hover:not(:disabled) {
            background: linear-gradient(135deg, var(--primary-600), var(--primary-700));
            box-shadow: var(--shadow-md);
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: var(--gray-100);
            color: var(--gray-700);
            border: 1px solid var(--gray-200);
        }
        
        .btn-secondary:hover:not(:disabled) {
            background: var(--gray-200);
            transform: translateY(-1px);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success-500), var(--success-600));
            color: white;
            box-shadow: var(--shadow-sm);
        }
        
        .btn-success:hover:not(:disabled) {
            background: linear-gradient(135deg, var(--success-600), #047857);
            box-shadow: var(--shadow-md);
            transform: translateY(-1px);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, var(--warning-500), var(--warning-600));
            color: white;
            box-shadow: var(--shadow-sm);
        }
        
        .btn-warning:hover:not(:disabled) {
            background: linear-gradient(135deg, var(--warning-600), #b45309);
            box-shadow: var(--shadow-md);
            transform: translateY(-1px);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--error-500), var(--error-600));
            color: white;
            box-shadow: var(--shadow-sm);
        }
        
        .btn-danger:hover:not(:disabled) {
            background: linear-gradient(135deg, var(--error-600), #b91c1c);
            box-shadow: var(--shadow-md);
            transform: translateY(-1px);
        }
        
        .btn-lg {
            padding: var(--space-4) var(--space-8);
            font-size: var(--text-base);
            min-height: 48px;
        }
        
        .btn-sm {
            padding: var(--space-2) var(--space-4);
            font-size: var(--text-xs);
            min-height: 36px;
        }
        
        /* Professional Icon System */
        .icon {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }
        
        .icon-sm {
            width: 16px;
            height: 16px;
        }
        
        .icon-lg {
            width: 24px;
            height: 24px;
        }
        
        .icon-xl {
            width: 32px;
            height: 32px;
        }
        
        /* Mission Type Icons */
        .mission-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: var(--space-3);
        }
        
        .mission-icon.kickoff {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
        }
        
        .mission-icon.empathy {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
        }
        
        .mission-icon.define {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            color: white;
        }
        
        .mission-icon.ideate {
            background: linear-gradient(135deg, #eab308, #ca8a04);
            color: white;
        }
        
        .mission-icon.prototype {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        
        .mission-icon.showcase {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }
        
        /* Status Indicators */
        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: var(--space-1) var(--space-3);
            border-radius: var(--radius-md);
            font-size: var(--text-xs);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .status-badge.active {
            background: var(--primary-100);
            color: var(--primary-700);
        }
        
        .status-badge.completed {
            background: var(--success-100);
            color: var(--success-700);
        }
        
        .status-badge.pending {
            background: var(--gray-100);
            color: var(--gray-600);
        }
        
        /* Enhanced Animations */
        .fadeIn {
            animation: fadeIn var(--duration-normal) var(--ease-out);
        }
        
        .slideInUp {
            animation: slideInUp var(--duration-normal) var(--ease-out);
        }
        
        .scaleIn {
            animation: scaleIn var(--duration-fast) var(--ease-out);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        /* Legacy Compatibility */
        .role-card {
            transition: all var(--duration-normal) var(--ease-out);
        }
        .role-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .action-button {
            transition: all var(--duration-fast) var(--ease-out);
        }
        .action-button:hover {
            transform: scale(1.02);
        }
        
        .scenario-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }
        
        .status-waiting {
            background-color: #f59e0b;
            animation: pulse 2s infinite;
        }
        
        .status-in-progress {
            background-color: #10b981;
            animation: pulse 2s infinite;
        }
        
        .status-completed {
            background-color: #6b7280;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
    
    {% block extra_head %}{% endblock %}
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <a href="{% url 'group_learning:game_list' %}" class="text-xl font-bold text-indigo-600">
                        🎯 Group Learning
                    </a>
                </div>
                
                <!-- Desktop Navigation -->
                <div class="hidden md:flex items-center space-x-4">
                    {% block nav_items %}
                    {% endblock %}
                </div>
                
                <!-- Mobile menu button -->
                <div class="md:hidden flex items-center">
                    <button type="button" 
                            onclick="toggleMobileMenu()"
                            class="text-gray-500 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 p-2 rounded-md"
                            aria-expanded="false"
                            aria-label="Toggle navigation menu">
                        <svg class="h-6 w-6" id="menu-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                        <svg class="h-6 w-6 hidden" id="close-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Mobile menu -->
        <div class="md:hidden hidden" id="mobile-menu">
            <div class="px-4 pt-2 pb-3 border-t border-gray-200 bg-gray-50">
                {% block mobile_nav_items %}
                {% endblock %}
            </div>
        </div>
    </nav>
    
    <!-- Messages -->
    {% if messages %}
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-4">
            {% for message in messages %}
                <div class="mb-4 p-4 rounded-md {% if message.tags == 'error' %}bg-red-100 text-red-700 border border-red-200{% elif message.tags == 'success' %}bg-green-100 text-green-700 border border-green-200{% else %}bg-blue-100 text-blue-700 border border-blue-200{% endif %}">
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}
    
    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {% block content %}
        {% endblock %}
    </main>
    
    <!-- Footer -->
    <footer class="mt-auto bg-white border-t">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="text-center text-gray-500 text-sm">
                © DecipherWorld - Collaborative Learning Platform
            </div>
        </div>
    </footer>
    
    <!-- JavaScript -->
    <script>
        // Mobile menu toggle function
        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobile-menu');
            const menuIcon = document.getElementById('menu-icon');
            const closeIcon = document.getElementById('close-icon');
            const button = event.currentTarget;
            
            if (mobileMenu.classList.contains('hidden')) {
                // Show menu
                mobileMenu.classList.remove('hidden');
                menuIcon.classList.add('hidden');
                closeIcon.classList.remove('hidden');
                button.setAttribute('aria-expanded', 'true');
            } else {
                // Hide menu
                mobileMenu.classList.add('hidden');
                menuIcon.classList.remove('hidden');
                closeIcon.classList.add('hidden');
                button.setAttribute('aria-expanded', 'false');
            }
        }
        
        // Close mobile menu when clicking outside
        document.addEventListener('click', function(event) {
            const mobileMenu = document.getElementById('mobile-menu');
            const menuButton = event.target.closest('[onclick="toggleMobileMenu()"]');
            
            if (!menuButton && !mobileMenu.contains(event.target) && !mobileMenu.classList.contains('hidden')) {
                toggleMobileMenu();
            }
        });
        
        // Show loading state
        function showLoadingState(elementId, message = 'Loading...') {
            const element = document.getElementById(elementId);
            if (element) {
                element.classList.add('opacity-50');
                element.setAttribute('data-loading', 'true');
                if (element.textContent) {
                    element.setAttribute('data-original-text', element.textContent);
                    element.textContent = message;
                }
            }
        }
        
        // Hide loading state
        function hideLoadingState(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.classList.remove('opacity-50');
                element.removeAttribute('data-loading');
                const originalText = element.getAttribute('data-original-text');
                if (originalText) {
                    element.textContent = originalText;
                    element.removeAttribute('data-original-text');
                }
            }
        }
        
        // Show error message
        function showErrorMessage(message, duration = 5000) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'fixed top-4 right-4 bg-red-500 text-white px-4 py-2 rounded-md shadow-lg z-50 transform translate-x-0 transition-transform duration-300';
            errorDiv.textContent = message;
            
            document.body.appendChild(errorDiv);
            
            setTimeout(() => {
                errorDiv.style.transform = 'translateX(100%)';
                setTimeout(() => errorDiv.remove(), 300);
            }, duration);
        }
        
        // Show success message
        function showSuccessMessage(message, duration = 3000) {
            const successDiv = document.createElement('div');
            successDiv.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-md shadow-lg z-50 transform translate-x-0 transition-transform duration-300';
            successDiv.textContent = message;
            
            document.body.appendChild(successDiv);
            
            setTimeout(() => {
                successDiv.style.transform = 'translateX(100%)';
                setTimeout(() => successDiv.remove(), 300);
            }, duration);
        }
        
        // Auto-refresh session status with improved error handling
        function updateSessionStatus(sessionCode) {
            if (!sessionCode) return;
            
            fetch(`/learn/api/session/${sessionCode}/status/`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Server error: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    // Update desktop status indicator
                    const statusElement = document.getElementById('session-status');
                    if (statusElement) {
                        const statusClass = `status-${data.status}`;
                        statusElement.className = `status-indicator ${statusClass}`;
                        statusElement.title = `Status: ${data.status}`;
                    }
                    
                    // Update mobile status indicator
                    const mobileStatusElement = document.getElementById('mobile-session-status');
                    if (mobileStatusElement) {
                        const statusClass = `status-${data.status}`;
                        mobileStatusElement.className = `status-indicator ${statusClass}`;
                        mobileStatusElement.title = `Status: ${data.status}`;
                    }
                    
                    // Update player count
                    const playerCountElement = document.getElementById('player-count');
                    if (playerCountElement) {
                        playerCountElement.textContent = data.player_count;
                    }
                    
                    // Clear any previous connection errors
                    const connectionError = document.getElementById('connection-error');
                    if (connectionError) {
                        connectionError.style.display = 'none';
                    }
                })
                .catch(error => {
                    console.log('Status update failed:', error);
                    // Show connection error indicator
                    const connectionError = document.getElementById('connection-error');
                    if (connectionError) {
                        connectionError.style.display = 'block';
                    } else {
                        // Create connection error indicator if it doesn't exist
                        const errorIndicator = document.createElement('div');
                        errorIndicator.id = 'connection-error';
                        errorIndicator.className = 'fixed bottom-4 left-4 bg-yellow-500 text-white px-3 py-1 rounded text-sm z-40';
                        errorIndicator.textContent = '⚠️ Connection issue';
                        document.body.appendChild(errorIndicator);
                    }
                });
        }
        
        // Initialize session status updates
        const sessionCode = document.body.getAttribute('data-session-code');
        if (sessionCode) {
            updateSessionStatus(sessionCode);
            setInterval(() => updateSessionStatus(sessionCode), 5000);
        }
    </script>
    
    {% block extra_js %}
    {% endblock %}
</body>
</html>