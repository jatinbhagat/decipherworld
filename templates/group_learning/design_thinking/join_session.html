{% extends 'base.html' %}
{% load static %}

{% block title %}Join Design Thinking Session - DecipherWorld{% endblock %}

{% block extra_head %}
<style>
  /* Minimal CSS for gradient background only */
  main {
    background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%) !important;
  }
</style>
{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto py-8 px-4">
  <div class="text-center mb-8">
    <h1 class="text-3xl font-bold text-gray-900 mb-2">🎓 Join Innovation Challenge</h1>
    <p class="text-gray-600">Enter your session code and team details to start innovating</p>
  </div>

  <!-- Instructions Card -->
  <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
    <div class="text-sm font-semibold text-blue-700 mb-2">How to Join</div>
    <ol class="text-xs text-blue-700 pl-4 space-y-1">
      <li>Get the 6-digit session code from your teacher</li>
      <li>Enter it below and choose your team name</li>
      <li>Pick a fun emoji to represent your team</li>
      <li>Start the Design Thinking challenge!</li>
    </ol>
  </div>

  <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-6">
    <!-- Display Messages -->
    {% if messages %}
      {% for message in messages %}
        <div class="p-3 rounded-lg mb-4 text-sm {% if message.level == DEFAULT_MESSAGE_LEVELS.ERROR %}bg-red-100 border border-red-200 text-red-700{% else %}bg-green-100 border border-green-200 text-green-700{% endif %}">
          {{ message }}
        </div>
      {% endfor %}
    {% endif %}

    <!-- Session Joining Form -->
    <form method="post" id="join-form">
      {% csrf_token %}
      
      <div class="mb-6">
        <label for="session_code" class="block text-sm font-medium text-gray-700 mb-2">Session Code</label>
        <input type="text" 
               id="session_code" 
               name="session_code" 
               required
               maxlength="6"
               placeholder="ABC123"
               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent text-center text-xl font-semibold tracking-widest uppercase transition-all duration-200">
        <div class="text-xs text-gray-500 mt-1">Ask your teacher for the 6-digit code</div>
      </div>

      <div class="mb-6">
        <label for="team_name" class="block text-sm font-medium text-gray-700 mb-2">Team Name</label>
        <input type="text" 
               id="team_name" 
               name="team_name" 
               required
               maxlength="100"
               placeholder="The Problem Solvers"
               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all duration-200">
        <div class="text-xs text-gray-500 mt-1">Choose a creative name for your team</div>
      </div>

      <div class="mb-6">
        <label class="block text-sm font-medium text-gray-700 mb-2">Team Emoji</label>
        <input type="hidden" id="team_emoji" name="team_emoji" value="💡">
        <div class="grid grid-cols-4 gap-2 mt-2">
          <div class="emoji-option p-3 border border-gray-300 rounded-lg bg-white hover:border-cyan-500 hover:bg-cyan-50 cursor-pointer transition-all duration-200 text-center text-xl border-cyan-500 bg-cyan-50" data-emoji="💡">💡</div>
          <div class="emoji-option p-3 border border-gray-300 rounded-lg bg-white hover:border-cyan-500 hover:bg-cyan-50 cursor-pointer transition-all duration-200 text-center text-xl" data-emoji="🚀">🚀</div>
          <div class="emoji-option p-3 border border-gray-300 rounded-lg bg-white hover:border-cyan-500 hover:bg-cyan-50 cursor-pointer transition-all duration-200 text-center text-xl" data-emoji="🎯">🎯</div>
          <div class="emoji-option p-3 border border-gray-300 rounded-lg bg-white hover:border-cyan-500 hover:bg-cyan-50 cursor-pointer transition-all duration-200 text-center text-xl" data-emoji="⭐">⭐</div>
          <div class="emoji-option p-3 border border-gray-300 rounded-lg bg-white hover:border-cyan-500 hover:bg-cyan-50 cursor-pointer transition-all duration-200 text-center text-xl" data-emoji="🔥">🔥</div>
          <div class="emoji-option p-3 border border-gray-300 rounded-lg bg-white hover:border-cyan-500 hover:bg-cyan-50 cursor-pointer transition-all duration-200 text-center text-xl" data-emoji="🌟">🌟</div>
          <div class="emoji-option p-3 border border-gray-300 rounded-lg bg-white hover:border-cyan-500 hover:bg-cyan-50 cursor-pointer transition-all duration-200 text-center text-xl" data-emoji="🏆">🏆</div>
          <div class="emoji-option p-3 border border-gray-300 rounded-lg bg-white hover:border-cyan-500 hover:bg-cyan-50 cursor-pointer transition-all duration-200 text-center text-xl" data-emoji="💎">💎</div>
        </div>
        <div class="text-xs text-gray-500 mt-1">Pick an emoji that represents your team spirit</div>
      </div>

      <!-- Team Member Info (Optional) -->
      <div class="mb-6">
        <label for="team_members" class="block text-sm font-medium text-gray-700 mb-2">Team Members (Optional)</label>
        <input type="text" 
               id="team_members" 
               name="team_members" 
               maxlength="300"
               placeholder="Alex, Jordan, Sam, Casey"
               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all duration-200">
        <div class="text-xs text-gray-500 mt-1">List your team members' names (comma-separated)</div>
      </div>

      <!-- Action Buttons -->
      <button type="submit" class="w-full bg-gradient-to-r from-cyan-500 to-cyan-600 text-white font-medium py-3 px-6 rounded-lg hover:from-cyan-600 hover:to-cyan-700 transition-all duration-200 mb-3" id="join-btn">
        🚀 Join Session & Start Challenge
      </button>
      
      <a href="{% url 'group_learning:design_thinking_start' %}" class="block w-full text-center bg-gray-100 text-gray-700 font-medium py-3 px-6 rounded-lg hover:bg-gray-200 transition-all duration-200">
        ← Back to Start Page
      </a>
    </form>
  </div>
</div>

<script>
// Auto-uppercase session code input
document.getElementById('session_code').addEventListener('input', function(e) {
    e.target.value = e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
});

// Emoji selection
document.querySelectorAll('.emoji-option').forEach(option => {
    option.addEventListener('click', function() {
        // Remove selected class from all options
        document.querySelectorAll('.emoji-option').forEach(opt => {
            opt.classList.remove('border-cyan-500', 'bg-cyan-50');
            opt.classList.add('border-gray-300', 'bg-white');
        });
        
        // Add selected class to clicked option
        this.classList.remove('border-gray-300', 'bg-white');
        this.classList.add('border-cyan-500', 'bg-cyan-50');
        
        // Update hidden input
        document.getElementById('team_emoji').value = this.dataset.emoji;
    });
});

// Form validation
document.getElementById('join-form').addEventListener('submit', function(e) {
    const sessionCode = document.getElementById('session_code').value.trim();
    const teamName = document.getElementById('team_name').value.trim();
    
    if (!sessionCode) {
        e.preventDefault();
        alert('Please enter a session code to continue.');
        document.getElementById('session_code').focus();
        return;
    }
    
    if (sessionCode.length !== 6) {
        e.preventDefault();
        alert('Session code must be 6 characters long.');
        document.getElementById('session_code').focus();
        return;
    }
    
    if (!teamName) {
        e.preventDefault();
        alert('Please enter a team name to continue.');
        document.getElementById('team_name').focus();
        return;
    }
    
    // Disable button to prevent double submission
    document.getElementById('join-btn').disabled = true;
    document.getElementById('join-btn').textContent = 'Joining Session...';
});

// Auto-focus session code input
document.getElementById('session_code').focus();
</script>
{% endblock %}