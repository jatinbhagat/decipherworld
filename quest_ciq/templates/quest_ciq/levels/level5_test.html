<!-- Level 5: Test/Presentation - Read-only Journey Summary -->

<div class="mb-6">
    <p class="text-lg mb-4">
        ğŸ‰ Congratulations! You've completed your Design Thinking journey. Here's a summary of your work:
    </p>
</div>

<!-- Empathy Summary -->
<div class="card bg-base-100 shadow-lg mb-6">
    <div class="card-body">
        <h3 class="card-title text-2xl">ğŸ‘€ Level 1: Empathy</h3>
        {% if session.responses.all|selectattr:"level_order==1"|first %}
        {% with l1_response=session.responses.all|selectattr:"level_order==1"|first %}
        {% with l1_answers=l1_response.get_answers %}
        <div class="mt-4">
            <h4 class="font-semibold mb-2">Selected Pain Points:</h4>
            <div class="flex flex-wrap gap-2 mb-4">
                {% for pain in l1_answers.preset_selected %}
                <span class="chip">{{ pain }}</span>
                {% endfor %}
                {% for pain in l1_answers.custom_entered %}
                <span class="chip bg-secondary text-secondary-content">{{ pain }} (Custom)</span>
                {% endfor %}
            </div>

            <h4 class="font-semibold mb-2">Who is Affected:</h4>
            <p class="badge badge-primary badge-lg mb-4">{{ l1_answers.who_is_affected|title }}</p>

            <h4 class="font-semibold mb-2">Top Priority:</h4>
            <p class="text-lg">ğŸ¯ <strong>{{ l1_answers.prioritized.top }}</strong></p>
            {% if l1_answers.prioritized.second %}
            <p class="text-base text-base-content/70 mt-1">2nd: {{ l1_answers.prioritized.second }}</p>
            {% endif %}
        </div>
        {% endwith %}
        {% endwith %}
        {% else %}
        <p class="text-base-content/50">(Not submitted yet)</p>
        {% endif %}
    </div>
</div>

<!-- Define Summary -->
<div class="card bg-base-100 shadow-lg mb-6">
    <div class="card-body">
        <h3 class="card-title text-2xl">ğŸ¯ Level 2: Define</h3>
        {% if session.responses.all|selectattr:"level_order==2"|first %}
        {% with l2_response=session.responses.all|selectattr:"level_order==2"|first %}
        {% with l2_answers=l2_response.get_answers %}
        <div class="mt-4">
            <div class="card bg-primary text-primary-content">
                <div class="card-body p-4">
                    <p class="text-lg font-semibold">{{ l2_answers.hmw_full }}</p>
                </div>
            </div>
        </div>
        {% endwith %}
        {% endwith %}
        {% else %}
        <p class="text-base-content/50">(Not submitted yet)</p>
        {% endif %}
    </div>
</div>

<!-- Ideate Summary -->
<div class="card bg-base-100 shadow-lg mb-6">
    <div class="card-body">
        <h3 class="card-title text-2xl">ğŸ’¡ Level 3: Ideate</h3>
        {% if session.responses.all|selectattr:"level_order==3"|first %}
        {% with l3_response=session.responses.all|selectattr:"level_order==3"|first %}
        {% with l3_answers=l3_response.get_answers %}
        <div class="mt-4">
            <div class="space-y-3">
                {% for idea in l3_answers.ideas %}
                {% if idea.strip %}
                <div class="card bg-base-200">
                    <div class="card-body p-4">
                        <p><strong>Idea {{ forloop.counter }}:</strong> {{ idea }}</p>
                    </div>
                </div>
                {% endif %}
                {% endfor %}
            </div>
        </div>
        {% endwith %}
        {% endwith %}
        {% else %}
        <p class="text-base-content/50">(Not submitted yet)</p>
        {% endif %}
    </div>
</div>

<!-- Prototype Summary -->
<div class="card bg-base-100 shadow-lg mb-6">
    <div class="card-body">
        <h3 class="card-title text-2xl">ğŸ› ï¸ Level 4: Prototype</h3>
        {% if session.responses.all|selectattr:"level_order==4"|first %}
        {% with l4_response=session.responses.all|selectattr:"level_order==4"|first %}
        {% with l4_answers=l4_response.get_answers %}
        <div class="mt-4">
            <h4 class="font-semibold mb-2">Selected Idea:</h4>
            <div class="card bg-accent text-accent-content mb-4">
                <div class="card-body p-4">
                    <p>{{ l4_answers.selected_idea_text }}</p>
                </div>
            </div>

            {% if l4_answers.prototype_explanation %}
            <h4 class="font-semibold mb-2">Prototype Explanation:</h4>
            <p class="mb-4">{{ l4_answers.prototype_explanation }}</p>
            {% endif %}

            {% if l4_answers.one_line_benefit %}
            <h4 class="font-semibold mb-2">Benefit:</h4>
            <p class="mb-4">âœ¨ {{ l4_answers.one_line_benefit }}</p>
            {% endif %}

            {% if l4_answers.materials %}
            <h4 class="font-semibold mb-2">Materials:</h4>
            <p class="mb-4">ğŸ› ï¸ {{ l4_answers.materials }}</p>
            {% endif %}

            {% if l4_answers.prototype_link %}
            <h4 class="font-semibold mb-2">Prototype Link:</h4>
            <a href="{{ l4_answers.prototype_link }}" target="_blank" class="link link-primary mb-4 block">
                ğŸ”— {{ l4_answers.prototype_link }}
            </a>
            {% endif %}

            {% if l4_answers.prototype_upload %}
            <h4 class="font-semibold mb-2">Prototype Image:</h4>
            <img src="{{ MEDIA_URL }}{{ l4_answers.prototype_upload }}" alt="Prototype" class="max-w-md rounded-lg shadow-lg">
            {% endif %}
        </div>
        {% endwith %}
        {% endwith %}
        {% else %}
        <p class="text-base-content/50">(Not submitted yet)</p>
        {% endif %}
    </div>
</div>

<!-- Completion Message -->
<div class="alert alert-success">
    <div>
        <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current flex-shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <div>
            <h4 class="font-bold">ğŸ‰ Quest Complete!</h4>
            <p class="text-sm">You've earned <strong>{{ session.total_score }} points</strong>. Check the leaderboard to see how you rank!</p>
        </div>
    </div>
</div>

<!-- Action Buttons -->
<div class="flex gap-4 justify-center mt-6">
    <a href="{% url 'quest_ciq:leaderboard' %}" class="btn btn-primary">
        ğŸ† View Leaderboard
    </a>
    <a href="{% url 'quest_ciq:progress' session_code=session.session_code %}" class="btn btn-ghost">
        ğŸ“ˆ View Progress
    </a>
</div>
