{% extends 'quest_ciq/base.html' %}

{% block title %}{{ quest.title }} - Summary{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto">
    <!-- Header -->
    <div class="bg-white rounded-lg shadow-lg p-8 mb-8">
        <h1 class="text-4xl font-bold text-blue-600 mb-4">Your Quest Journey</h1>
        <div class="flex justify-between items-center">
            <div>
                <p class="text-gray-700 text-lg">{{ quest.title }}</p>
                <p class="text-gray-600">Completed: {{ session.completed_at|date:"F d, Y"|default:"In Progress" }}</p>
            </div>
            <div class="text-right">
                <p class="text-sm text-gray-600">Total Score</p>
                <p class="text-4xl font-bold text-blue-600">{{ total_score }} pts</p>
            </div>
        </div>
    </div>

    <!-- Level Summaries -->
    <div class="space-y-6">
        {% for data in level_data %}
        <div class="bg-white rounded-lg shadow-lg p-6">
            <div class="flex items-center mb-4">
                <div class="w-12 h-12 rounded-full {% if data.response %}bg-green-500{% else %}bg-gray-400{% endif %} flex items-center justify-center text-white font-bold text-xl mr-4">
                    {{ data.level.order }}
                </div>
                <div class="flex-1">
                    <h2 class="text-2xl font-bold text-gray-800">{{ data.level.name }}</h2>
                    <p class="text-gray-600">{{ data.level.short_help }}</p>
                </div>
                <div class="text-right">
                    <p class="text-sm text-gray-600">Score</p>
                    <p class="text-2xl font-bold text-blue-600">{{ data.score }} pts</p>
                </div>
            </div>

            {% if data.response %}
            <div class="border-t pt-4 space-y-3">
                <!-- Level 1: Empathy -->
                {% if data.level.order == 1 %}
                    <div>
                        <p class="text-sm font-bold text-gray-700">Observed Problem:</p>
                        <p class="text-gray-800">{{ data.answers.observed_problem|default:"Not provided" }}</p>
                    </div>
                    <div>
                        <p class="text-sm font-bold text-gray-700">Who is Affected:</p>
                        <p class="text-gray-800">{{ data.answers.who_is_affected|capfirst|default:"Not provided" }}</p>
                    </div>
                    <div>
                        <p class="text-sm font-bold text-gray-700">Why Important:</p>
                        <p class="text-gray-800">{{ data.answers.why_important|default:"Not provided" }}</p>
                    </div>

                <!-- Level 2: Define -->
                {% elif data.level.order == 2 %}
                    <div>
                        <p class="text-sm font-bold text-gray-700">Problem Statement:</p>
                        <p class="text-gray-800">{{ data.answers.problem_statement|default:"Not provided" }}</p>
                    </div>
                    <div>
                        <p class="text-sm font-bold text-gray-700">Root Causes:</p>
                        <p class="text-gray-800">{{ data.answers.root_causes|default:"Not provided" }}</p>
                    </div>

                <!-- Level 3: Ideate -->
                {% elif data.level.order == 3 %}
                    <div>
                        <p class="text-sm font-bold text-gray-700">Solution Ideas:</p>
                        <p class="text-gray-800 whitespace-pre-line">{{ data.answers.ideas_list|default:"Not provided" }}</p>
                    </div>
                    {% if data.answers.wildcard_idea %}
                    <div>
                        <p class="text-sm font-bold text-gray-700">Wildcard Idea:</p>
                        <p class="text-gray-800">{{ data.answers.wildcard_idea }}</p>
                    </div>
                    {% endif %}

                <!-- Level 4: Prototype -->
                {% elif data.level.order == 4 %}
                    {% if data.response.prototype_upload %}
                    <div>
                        <p class="text-sm font-bold text-gray-700 mb-2">Prototype Image:</p>
                        <img src="{{ data.response.prototype_upload.url }}" alt="Prototype" class="max-w-md rounded-lg shadow">
                    </div>
                    {% endif %}
                    {% if data.answers.prototype_link %}
                    <div>
                        <p class="text-sm font-bold text-gray-700">Prototype Link:</p>
                        <a href="{{ data.answers.prototype_link }}" target="_blank" class="text-blue-600 hover:underline">{{ data.answers.prototype_link }}</a>
                    </div>
                    {% endif %}
                    <div>
                        <p class="text-sm font-bold text-gray-700">Materials Used:</p>
                        <p class="text-gray-800">{{ data.answers.materials|default:"Not provided" }}</p>
                    </div>
                    <div>
                        <p class="text-sm font-bold text-gray-700">Key Benefit:</p>
                        <p class="text-gray-800">{{ data.answers.one_line_benefit|default:"Not provided" }}</p>
                    </div>

                <!-- Level 5: Test -->
                {% elif data.level.order == 5 %}
                    <div>
                        <p class="text-sm font-bold text-gray-700">Peer Tester:</p>
                        <p class="text-gray-800">{{ data.answers.peer_name|default:"Not provided" }}</p>
                    </div>
                    <div>
                        <p class="text-sm font-bold text-gray-700">Peer Rating:</p>
                        <div class="flex items-center">
                            <p class="text-gray-800 mr-2">{{ data.answers.peer_rating|default:"--" }} / 5</p>
                            <div class="flex">
                                {% for i in "12345" %}
                                    {% if forloop.counter <= data.answers.peer_rating|default:0 %}
                                        <span class="text-yellow-400 text-xl">★</span>
                                    {% else %}
                                        <span class="text-gray-300 text-xl">★</span>
                                    {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    <div>
                        <p class="text-sm font-bold text-gray-700">Peer Feedback:</p>
                        <p class="text-gray-800 whitespace-pre-line">{{ data.answers.peer_comment|default:"Not provided" }}</p>
                    </div>
                {% endif %}
            </div>
            {% else %}
            <div class="border-t pt-4">
                <p class="text-gray-500 italic">This level has not been completed yet.</p>
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>

    <!-- Actions -->
    <div class="mt-8 flex justify-between">
        <a href="{% url 'quest_ciq:quest_home_slug' slug=quest.slug %}"
           class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-8 rounded-lg transition duration-200">
            Back to Home
        </a>
        <a href="{% url 'quest_ciq:quest_leaderboard_slug' slug=quest.slug %}"
           class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg transition duration-200">
            View Leaderboard
        </a>
    </div>
</div>
{% endblock %}
