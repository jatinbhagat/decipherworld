{% extends "base.html" %}
{% load static %}

{% block title %}Create Climate Game Session - DecipherWorld{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'group_learning/css/climate_game.css' %}">
<style>
  /* Compact viewport-optimized design */
  .session-container {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1rem;
    background: linear-gradient(135deg, #e8f5e8 0%, #e0f2f1 50%, #e1f5fe 100%);
  }
  
  .session-card {
    max-width: 1000px;
    width: 100%;
    max-height: 90vh;
    background: white;
    border-radius: 20px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.1);
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }
  
  .header-section {
    background: linear-gradient(135deg, #2e7d32 0%, #388e3c 100%);
    color: white;
    padding: 1.5rem;
    text-align: center;
  }
  
  .form-container {
    flex: 1;
    overflow-y: auto;
    padding: 1.5rem;
  }
  
  .compact-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
  }
  
  .role-preview {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 0.5rem;
    margin-top: 0.5rem;
  }
  
  .role-mini {
    background: #f5f5f5;
    border-radius: 8px;
    padding: 0.5rem;
    text-align: center;
    font-size: 0.75rem;
  }
  
  .quick-settings {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    margin-top: 1rem;
  }
  
  .footer-actions {
    padding: 1rem 1.5rem;
    border-top: 1px solid #e0e0e0;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  @media (max-width: 768px) {
    .compact-grid {
      grid-template-columns: 1fr;
    }
    .session-card {
      margin: 0.5rem;
      max-height: 95vh;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="session-container">
  <div class="session-card">
    
    <!-- Compact Header -->
    <div class="header-section">
      <h1 class="text-2xl font-bold mb-2">üåç Climate Crisis India</h1>
      <p class="text-green-100">Create classroom session ‚Ä¢ 5-35 students ‚Ä¢ 45-60 minutes</p>
    </div>
    
    <!-- Form Content -->
    <div class="form-container">
      <form method="post" id="sessionForm">
        {% csrf_token %}
        
        <!-- Add required game_id field -->
        {% for climate_game in climate_games %}
        <input type="hidden" name="game_id" value="{{ climate_game.id }}">
        {% endfor %}
        
        <!-- Two Column Layout -->
        <div class="compact-grid">
          
          <!-- Left: Session Setup -->
          <div>
            <h2 class="text-lg font-bold mb-3 flex items-center gap-2">
              <i class="fas fa-cog text-green-600"></i>
              Session Setup
            </h2>
            
            <!-- Essential Fields Only -->
            <div class="space-y-3">
              <div class="form-control">
                <label class="label py-1">
                  <span class="label-text font-medium">Facilitator Name</span>
                  <span class="label-text-alt text-red-500">*</span>
                </label>
                <input type="text" name="facilitator_name" 
                       class="input input-bordered input-sm" 
                       placeholder="Your name" required>
              </div>
              
              <div class="form-control">
                <label class="label py-1">
                  <span class="label-text font-medium">Session Name</span>
                </label>
                <input type="text" name="session_name" 
                       class="input input-bordered input-sm" 
                       placeholder="Climate Challenge - Grade 9"
                       value="Climate Challenge Session">
              </div>
              
              <div class="form-control">
                <label class="label py-1">
                  <span class="label-text font-medium">Class Size</span>
                  <span class="label-text-alt text-red-500">*</span>
                </label>
                <select name="expected_players" class="select select-bordered select-sm" required>
                  <option value="">Select size</option>
                  <option value="10">Small (5-15 students)</option>
                  <option value="25" selected>Medium (15-35 students)</option>
                  <option value="50">Large (35+ students)</option>
                </select>
              </div>
            </div>
            
            <!-- Quick Settings -->
            <div class="quick-settings">
              <div class="form-control">
                <label class="label py-1">
                  <span class="label-text text-sm">Question Time</span>
                </label>
                <select name="question_duration" class="select select-bordered select-sm">
                  <option value="45">45 sec</option>
                  <option value="60" selected>60 sec</option>
                  <option value="90">90 sec</option>
                </select>
              </div>
              
              <div class="form-control">
                <label class="cursor-pointer label py-1">
                  <span class="label-text text-sm">Auto-advance</span>
                  <input type="checkbox" name="auto_advance" class="checkbox checkbox-sm" checked>
                </label>
              </div>
            </div>
          </div>
          
          <!-- Right: Game Preview -->
          <div>
            <h2 class="text-lg font-bold mb-3 flex items-center gap-2">
              <i class="fas fa-eye text-green-600"></i>
              Game Overview
            </h2>
            
            <!-- Role Preview -->
            <div class="mb-4">
              <h3 class="text-sm font-medium mb-2">Student Roles (Auto-assigned):</h3>
              <div class="role-preview">
                <div class="role-mini bg-blue-100 text-blue-700">
                  <div class="text-lg">üèõÔ∏è</div>
                  <div>Govt</div>
                </div>
                <div class="role-mini bg-purple-100 text-purple-700">
                  <div class="text-lg">üè¢</div>
                  <div>Business</div>
                </div>
                <div class="role-mini bg-green-100 text-green-700">
                  <div class="text-lg">üåæ</div>
                  <div>Farmer</div>
                </div>
                <div class="role-mini bg-orange-100 text-orange-700">
                  <div class="text-lg">üèôÔ∏è</div>
                  <div>Citizen</div>
                </div>
                <div class="role-mini bg-teal-100 text-teal-700">
                  <div class="text-lg">ü§ù</div>
                  <div>NGO</div>
                </div>
              </div>
            </div>
            
            <!-- Game Flow -->
            <div class="space-y-2">
              <div class="flex items-center gap-2 text-sm">
                <span class="w-6 h-6 bg-green-100 text-green-600 rounded-full flex items-center justify-center font-bold text-xs">1</span>
                <span>Students join with session code</span>
              </div>
              <div class="flex items-center gap-2 text-sm">
                <span class="w-6 h-6 bg-green-100 text-green-600 rounded-full flex items-center justify-center font-bold text-xs">2</span>
                <span>5 climate scenarios with choices</span>
              </div>
              <div class="flex items-center gap-2 text-sm">
                <span class="w-6 h-6 bg-green-100 text-green-600 rounded-full flex items-center justify-center font-bold text-xs">3</span>
                <span>Real-time results and discussion</span>
              </div>
              <div class="flex items-center gap-2 text-sm">
                <span class="w-6 h-6 bg-green-100 text-green-600 rounded-full flex items-center justify-center font-bold text-xs">4</span>
                <span>Reflection and insights</span>
              </div>
            </div>
            
            <!-- Quick Stats -->
            <div class="grid grid-cols-2 gap-2 mt-4">
              <div class="bg-blue-50 p-2 rounded text-center">
                <div class="font-bold text-blue-600 text-sm">5 Rounds</div>
                <div class="text-blue-500 text-xs">Crisis scenarios</div>
              </div>
              <div class="bg-green-50 p-2 rounded text-center">
                <div class="font-bold text-green-600 text-sm">Real-time</div>
                <div class="text-green-500 text-xs">Collaboration</div>
              </div>
            </div>
          </div>
          
        </div>
      </form>
    </div>
    
    <!-- Action Footer -->
    <div class="footer-actions">
      <a href="{% url 'group_learning:climate_game_home' %}" 
         class="btn btn-ghost btn-sm">
        <i class="fas fa-arrow-left"></i> Back
      </a>
      
      <button type="submit" form="sessionForm" 
              class="btn btn-success btn-lg gap-2" id="createBtn">
        <i class="fas fa-play-circle"></i>
        Create Session
      </button>
    </div>
    
  </div>
</div>

<!-- Messages -->
{% if messages %}
<div class="toast toast-top toast-end z-50">
  {% for message in messages %}
  <div class="alert alert-{{ message.tags|default:'info' }}">
    <i class="fas fa-{{ message.tags|default:'info'|yesno:'check-circle,exclamation-triangle,info-circle' }}"></i>
    <span>{{ message }}</span>
  </div>
  {% endfor %}
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('sessionForm');
  const createBtn = document.getElementById('createBtn');
  
  // Form validation
  form.addEventListener('submit', function(e) {
    const facilitatorName = document.querySelector('[name="facilitator_name"]').value.trim();
    const expectedPlayers = document.querySelector('[name="expected_players"]').value;
    
    if (!facilitatorName) {
      e.preventDefault();
      alert('Please enter your name as facilitator');
      document.querySelector('[name="facilitator_name"]').focus();
      return;
    }
    
    if (!expectedPlayers) {
      e.preventDefault();
      alert('Please select expected number of students');
      document.querySelector('[name="expected_players"]').focus();
      return;
    }
    
    // Show loading state
    createBtn.classList.add('loading');
    createBtn.disabled = true;
  });
  
  // Auto-focus first input
  document.querySelector('[name="facilitator_name"]').focus();
});
</script>
{% endblock %}